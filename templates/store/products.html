<!DOCTYPE html>
{% extends 'base.html' %}
{% load static %}
{% load humanize %}
{% block content %}
<style>
    .filter-section { background: #fff; border-radius: 5px; padding: 15px; margin-bottom: 10px; }
    .product-card { background: #fff; border-radius: 5px; padding: 10px; margin-bottom: 2px; transition: all .1s; display: flex; flex-direction: column; height: 400px; }
    .product-card:hover { transform: scale(1.02); box-shadow: 0 8px 16px rgba(0,0,0,0.1); }
    .product-card img {
        position: relative;
        z-index: 1;   /* image stays below */
    }
    .product-card img:hover { filter: brightness(1.08); }
    .product-card .card-title a:hover { color: tomato; }
    .product-card .badge {
        position: absolute;
        z-index: 2;   /* ensures badge is above the image */
    }
    .product-card .card-body {
        flex: 1; /* makes body stretch */
        display: flex;
        flex-direction: column;
    }
    .product-card .product-info {
        flex: 1; /* forces equal height for product description area */
        overflow: hidden;        /* hides overflow if too long */
        text-overflow: ellipsis; /* adds ... if text is cut */
    }
    .product-card .buy-now {
        margin-top: auto; /* pushes button to bottom */
    }
    .price { font-size: 16px; font-weight: bold; color: #d9534f; }
    .old-price { text-decoration: line-through; color: gray; font-size: 14px; }
    .filter-title { font-weight: bold; margin-bottom: 10px; }
    .category-pill { border: 1px solid #ccc; margin: 3px; border-radius: 25px; padding: 5px 15px; cursor: pointer; background: white; }
    .category-pill:hover { background: #f1f1f1; }
    .active-pill { background: #0d6efd; color: white; }
</style>

<body>
<div class="container-fluid">
    <nav aria-label="breadcrumb">
      <ol class="breadcrumb">
        <li class="breadcrumb-item"><a href="/"><i class="fas fa-home"></i></a></li>
        <li class="breadcrumb-item active" aria-current="page"><a href="{% url 'product_list' %}" style="color: dimgray">Products</a></li>
      </ol>
    </nav>
</div>
<div class="container-fluid mt-3">
  <div>
    {% if selected_category %}
      <h3 class="fw-bold mb-3" style="color: royalblue; font-family: 'Candara', Arial, sans-serif;">
          {{ selected_category }} Price in Bangladesh</h3>
    {% else %}
      <h3 class="fw-bold mb-3" style="color: royalblue; font-family: 'Candara', Arial, sans-serif;">
          All Products Price in Bangladesh</h3>
    {% endif %}
  </div>
  <!-- Sub Categories -->
  <div class="d-flex flex-wrap mb-3">
    <div class="category-pill active-pill" data-category="all">All Products</div>
    <div class="category-pill" data-category="oled">Product Accessories</div>
    <div class="category-pill" data-category="gaming">Gaming Product</div>
    <div class="category-pill" data-category="ultrabook">Premium Products</div>
    <div class="category-pill" data-category="accessories">Upcoming Products</div>
    <div class="category-pill" data-category="intel_i5">Latest Gadgets</div>
  </div>

  <div class="row g-3">
    <!-- Filters -->
    <div class="col-md-3" style="width: 300px;">
      <div class="filter-section">
        <div class="filter-title">Price Range</div>
        <input type="range" min="0" max="1000000" value="250000" id="priceRange" class="form-range">
        <p>Up to: <span id="priceValue">950000</span>৳</p>
      </div>
      <div class="filter-section">
        <div class="filter-title">Availability</div>
        <div><input type="checkbox" class="filter" value="in_stock"> In Stock</div>
        <div><input type="checkbox" class="filter" value="pre_order"> Pre Order</div>
        <div><input type="checkbox" class="filter" value="upcoming"> Up Coming</div>
      </div>
      <div class="filter-section">
        <div class="filter-title">Brand</div>
        <div><input type="checkbox" class="filter" value="apple"> A</div>
        <div><input type="checkbox" class="filter" value="hp"> B</div>
        <div><input type="checkbox" class="filter" value="dell"> C</div>
        <div><input type="checkbox" class="filter" value="lenovo"> D</div>
      </div>
    </div>

    <!-- Product List -->
    <div class="col-md-9">
      <div class="row row-cols-2 row-cols-md-3 row-cols-lg-4 g-2" id="product-list">
        {% for product in products %}
        <div class="col-md-3 mb-1">
          <div class="product-card h-100 w-100 border-0 rounded-3 shadow-sm position-relative">
                <!-- Discount Tag -->
                {% if product.discount > 0 %}
                    <span class="badge m-2 px-2 py-1"
                          style="top:0; right:0; font-size:12px; background: darkviolet">
                        Save: {{ product.discount|intcomma }}৳ (-{{ product.discount_percentage|floatformat:0 }})%
                    </span>
                {% endif %}

                <a href="{% url 'product_details' product.slug %}">
                    <img src="{{ product.product_image.url }}"
                         alt="{{ product.name }}"
                         class="img-fluid mb-2 mx-auto d-block"
                         style="width: 210px; height: 210px; object-fit: contain;">
                </a>

                <div class="card-body d-flex flex-column">
                    <small class="card-title fw-bold">
                        <a href="{% url 'product_details' product.slug %}">
                            {{ product.name }}
                        </a>
                    </small>

                    <div class="product-info">
                        <p class="text-muted my-3">
                            <small>{{ product.specification }}</small>
                        </p>
                    </div>

                    <hr>
                    <div class="text-center mb-2">
                        <span class="price">{{ product.special_price|intcomma }}৳</span>
                        {% if product.regular_price %}
                            <span class="old-price ms-2">{{ product.regular_price|intcomma }}৳</span>
                        {% endif %}
                    </div>

                    <div class="text-center buy-now">
                        <a href="{% url 'checkout' product.slug %}">
                            <button class="button mt-3" style="border-radius: 10px; width: 180px">
                                <span>Buy Now</span>
                            </button>
                        </a>
                    </div>
                </div>
            </div>
        </div>
        {% empty %}
            <p class="mt-3">No products found.</p>
        {% endfor %}
      </div>

      <!-- Pagination -->
      <nav>
        <ul class="pagination mt-3">
          {% if products.has_previous %}
            <li class="page-item"><a class="page-link" href="?page={{ products.previous_page_number }}">Prev</a></li>
          {% endif %}
          {% for num in products.paginator.page_range %}
            <li class="page-item {% if products.number == num %}active{% endif %}">
              <a class="page-link" href="?page={{ num }}">{{ num }}</a>
            </li>
          {% endfor %}
          {% if products.has_next %}
            <li class="page-item"><a class="page-link" href="?page={{ products.next_page_number }}">Next</a></li>
          {% endif %}
        </ul>
      </nav>
    </div>
  </div>
</div>
</body>
{% endblock %}
{% block extra_js %}
<script src="{% static 'store/products.js' %}"></script>
{% endblock %}