<!DOCTYPE html>
{% extends 'base.html' %}
{% load static %}
{% load humanize %}
{% block content %}
<style>
    body { background: #E6FFE3; }
    .order-summary { background: #fff; border-radius: 12px; padding: 20px; box-shadow: 0 2px 8px rgba(0,0,0,0.05); }
    .order-summary h4 { font-weight: 600; margin-bottom: 15px; }
    .order-summary a { text-decoration: none; font-weight: 600; }
    .order-summary input { border: 1px solid dimgray; }
    .form-section input { border-radius: 25px; border: 1px solid darkgray; height: 42px; }
    .cod-rules { background: whitesmoke; padding: 15px; border-radius: 12px; font-size: 15px; }
    .cod-rules p { color: darkslategray; }
    .form-notes { height: 200px; border-radius: 25px; padding: 10px; }
    .form-transaction-id { border-radius: 25px; border: 1px solid darkgray !important; height: 42px; }
    .btn-order { background: #3d5afe; color: #fff; font-weight: 600; padding: 10px; border-radius: 6px; width: 100%; border: none; }
    .btn-order:hover { background: #2c46d3; }
    .order-product-img { width: 90px; height: 90px; object-fit: contain; border-radius: 8px; }
    /* Custom dropdown with search */
    .custom-dropdown { position: relative; }
    .custom-dropdown .dropdown-menu {
        max-height: 300px;
        overflow-y: auto;
        width: 100%;
    }
    .custom-dropdown .dropdown-menu input {
        width: 95%;
        margin: 5px auto;
        display: block;
    }
</style>

<div class="container-fluid ps-6">
    <nav aria-label="breadcrumb">
      <ol class="breadcrumb">
        <li class="breadcrumb-item"><a href="/"><i class="fas fa-home"></i></a></li>
        <li class="breadcrumb-item active" aria-current="page"><a href="{% url 'checkout' product.slug %}" style="color: dimgray">Checkout</a></li>
      </ol>
    </nav>
</div>
<div class="content px-6">
    <form method="POST">
        {% csrf_token %}
        <div class="row">
            <!-- Billing Form -->
            <div class="col-md-6 p-3 form-section">
                <h4>Billing Details</h4>

                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label class="form-label">First name</label><span class="ps-1" style="color: #de001e;">*</span>
                        <input type="text" name="first_name" class="form-control" required>
                    </div>
                    <div class="col-md-6 mb-3">
                        <label class="form-label">Last name (optional)</label>
                        <input type="text" name="last_name" class="form-control">
                    </div>
                </div>
                <div class="mb-3">
                    <label class="form-label">Phone</label><span class="ps-1" style="color: #de001e;">*</span>
                    <input type="text" name="phone" class="form-control" required>
                </div>
                <div class="mb-3">
                    <label class="form-label">Street Address</label><span class="ps-1" style="color: #de001e;">*</span>
                    <input type="text" name="street_address" class="form-control" required>
                </div>
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label class="form-label">Town / City (optional)</label>
                        <input type="text" name="town_city" class="form-control">
                    </div>
                    <div class="col-md-6 mb-3">
                        <label class="form-label">Country / Region</label><span class="ps-1" style="color: #de001e;">*</span>
                        <input type="text" name="country" class="form-control" value="Bangladesh" readonly>
                    </div>
                </div>

                <!-- District Dropdown with Search -->
                <div class="mb-3 custom-dropdown">
                    <label class="form-label">District (optional)</label>
                    <div class="dropdown">
                        <button class="btn btn-outline-secondary w-100 dropdown-toggle" type="button" id="districtDropdown" data-bs-toggle="dropdown" aria-expanded="false">
                            Select District
                        </button>
                        <ul class="dropdown-menu" aria-labelledby="districtDropdown" id="districtList">
                            <li><input type="text" class="form-control" placeholder="Search..." id="districtSearch"></li>
                            {% for district in districts %}
                                <li><a class="dropdown-item district-option" href="#">{{ district }}</a></li>
                            {% endfor %}
                        </ul>
                        <input type="hidden" name="district" id="districtInput">
                    </div>
                </div>
                <div class="mb-3">
                    <label class="form-label">Email (optional)</label>
                    <input type="email" name="email" class="form-control">
                </div>
                <div class="mb-3">
                    <label class="form-label">Order Notes (optional)</label>
                    <textarea name="notes" class="form-control form-notes"></textarea>
                </div>
            </div>

            <!-- Order Summary -->
            <div class="col-md-6 order-summary">
                <h4 class="text-center">Your Order</h4>
                <table class="table">
                    <thead>
                        <tr>
                            <th>PRODUCT</th>
                            <th class="text-end">SUBTOTAL</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>
                                <div class="d-flex align-items-center">
                                    <img src="{{ product.product_image.url }}" alt="{{ product.name }}" class="order-product-img me-3">
                                    <div>
                                        <p class="mb-0">{{ product.name }}</p>
                                        <small>SKU: </small><small class="text-muted">{{ product.product_code }}</small><br>
                                        <small>Qty: {{ quantity }}</small>
                                    </div>
                                </div>
                            </td>
                            <td class="text-end text-muted">{{ subtotal|intcomma }}৳</td>
                        </tr>
                        <tr>
                            <td>Subtotal</td>
                            <td class="text-end"><span id="subtotal" data-subtotal="{{ subtotal }}">{{ subtotal|intcomma }}</span>৳</td>
                        </tr>
                        <tr>
                            <td>Shipping</td>
                            <td class="text-end"><span id="shipping">{{ shipping }}</span>৳</td>
                        </tr>
                        <tr>
                            <th>Total</th>
                            <th class="text-end text-primary"><span id="total">{{ total|intcomma }}</span>৳</th>
                        </tr>
                    </tbody>
                </table>

                <!-- Payment Methods -->
                <div class="payment-methods mt-4">
                    <div class="form-check">
                        <input class="form-check-input" type="radio" checked="checked" name="payment_method" id="cod_outside" value="cod_outside" required>
                        <label class="form-check-label fw-bold" for="cod_outside">
                            Cash On Delivery (Outside Dhaka)
                        </label>
                        <div id="outside-cod-field" class="cod-rules mt-3">
                            <p class="mb-0">
                                For Ordering Outside Dhaka, The Courier Charge Must Be Paid in Advance. <br>
                                ঢাকার বাইরে অর্ডার করার জন্য কুরিয়ার চার্জ ১০০ Taka অব্যশই আগে বিকাশ থেকে সেন্ড মানি করতে হবে। <br>
                                Bkash Send Money No : 01735-473925 (Personal) || Rocket Send Money No : 01543-678832 (Personal)
                                || Nagad Send Money No : 01957-645871 (Personal)
                            </p>

                            <!-- Transaction ID field -->
                            <div class="mt-2">
                                <label for="transaction_id" class="form-label">Transaction ID</label><span class="ps-1" style="color: #de001e;">*</span>
                                <input type="number" class="form-control form-transaction-id" name="transaction_id" id="transaction_id">
                            </div>
                        </div>
                    </div>
                    <div class="form-check mt-4">
                        <input class="form-check-input" type="radio" name="payment_method" id="cod_inside" value="cod_inside" required>
                        <label class="form-check-label fw-bold" for="cod_inside">
                            Cash On Delivery (Inside Dhaka)
                        </label>
                        <div id="inside-cod-field" class="cod-rules mt-3">
                            <p class="mb-0">
                                Pay with Cash Upon Delivery.
                            </p>
                        </div>
                    </div>
                </div>

                <div class="form-check mt-4">
                    <input type="checkbox" class="form-check-input" required id="terms">
                    <label for="terms" class="form-check-label">
                        Yes I have read and agree to the website
                        <a href="#" onclick="event.preventDefault();">terms and conditions</a>,
                        <a href="#" onclick="event.preventDefault();">privacy policy</a>,
                        <a href="#" onclick="event.preventDefault();">returns & refunds</a>
                        <span style="color: #de001e;">*</span>
                    </label>
                </div>

                <button type="submit" class="btn-order mt-4">Place Order</button>
            </div>
        </div>
     </form>
</div>
{% endblock %}
{% block extra_js %}
<script src="{% static 'orders/checkout.js' %}"></script>
{% endblock %}